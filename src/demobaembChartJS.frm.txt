Version =20
VersionRequired =20
PublishOption =1
Begin Form
    RecordSelectors = NotDefault
    MaxButton = NotDefault
    MinButton = NotDefault
    NavigationButtons = NotDefault
    DividingLines = NotDefault
    AllowDesignChanges = NotDefault
    DefaultView =0
    ScrollBars =0
    BorderStyle =3
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridX =24
    GridY =24
    Width =20160
    DatasheetFontHeight =11
    ItemSuffix =7
    Right =19860
    Bottom =7995
    DatasheetGridlinesColor =14806254
    OnUnload ="[Event Procedure]"
    RecSrcDt = Begin
        0xf20e8ebdd288e440
    End
    GUID = Begin
        0xd4a1a937c995d04a803db1617ad8e82a
    End
    Caption ="baembChartJS Demo"
    OnOpen ="[Event Procedure]"
    DatasheetFontName ="Calibri"
    PrtMip = Begin
    End
    PrtDevMode = Begin
    End
    PrtDevNames = Begin
    End
    OnLoad ="[Event Procedure]"
    FilterOnLoad =0
    ShowPageMargins =0
    DisplayOnSharePointSite =1
    DatasheetAlternateBackColor =15921906
    DatasheetGridlinesColor12 =0
    FitToScreen =1
    DatasheetBackThemeColorIndex =1
    BorderThemeColorIndex =3
    ThemeFontIndex =1
    ForeThemeColorIndex =0
    AlternateBackThemeColorIndex =1
    AlternateBackShade =95.0
    PrtDevModeW = Begin
    End
    PrtDevNamesW = Begin
    End
    NoSaveCTIWhenDisabled =1
    Begin
        Begin Label
            BackStyle =0
            FontSize =11
            FontName ="Calibri"
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =0
            BorderTint =50.0
            ForeThemeColorIndex =0
            ForeTint =50.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin CommandButton
            FontSize =11
            FontWeight =400
            FontName ="Calibri"
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            UseTheme =1
            Shape =1
            Gradient =12
            BackThemeColorIndex =4
            BackTint =60.0
            BorderLineStyle =0
            BorderColor =16777215
            BorderThemeColorIndex =4
            BorderTint =60.0
            ThemeFontIndex =1
            HoverThemeColorIndex =4
            HoverTint =40.0
            PressedThemeColorIndex =4
            PressedShade =75.0
            HoverForeThemeColorIndex =0
            HoverForeTint =75.0
            PressedForeThemeColorIndex =0
            PressedForeTint =75.0
        End
        Begin Subform
            BorderLineStyle =0
            BorderThemeColorIndex =1
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            BorderShade =65.0
            ShowPageHeaderAndPageFooter =1
        End
        Begin Section
            CanGrow = NotDefault
            Height =8100
            Name ="Detail"
            GUID = Begin
                0x546c569153ad414ab7d24617e8cd6543
            End
            AlternateBackColor =15921906
            AlternateBackThemeColorIndex =1
            AlternateBackShade =95.0
            BackThemeColorIndex =1
            Begin
                Begin Subform
                    OverlapFlags =85
                    OldBorderStyle =0
                    Left =120
                    Top =120
                    Width =18000
                    Height =7920
                    BorderColor =10921638
                    Name ="subChart"
                    GUID = Begin
                        0x750f42c3234b6b48b4726878ff7d4d39
                    End
                    GridlineColor =10921638
                    HorizontalAnchor =2
                    VerticalAnchor =2

                    LayoutCachedLeft =120
                    LayoutCachedTop =120
                    LayoutCachedWidth =18120
                    LayoutCachedHeight =8040
                End
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit

Private WithEvents bemb As BembObject
Attribute bemb.VB_VarHelpID = -1

Private Sub Form_Open(Cancel As Integer)

    gstrBAEMB_DEMO = BAEMB_DEMO_PATH & BAEMB_SCRIPT_PATH

    If Not BembRegistry.IsIEEmulationModeSet(IEEmulation11) Then
        If MsgBox("IE Emulation Mode registry value not set... would you like the application to set it now?", vbOKCancel + vbQuestion, "browseEmbed") = vbCancel Then
            Cancel = True
            Exit Sub
        Else
            If Not BembRegistry.SetIEEmulationMode(IEEmulation11) Then
                Cancel = True
            Else
                MsgBox "Registry successfully updated.  Please restart Access for this to take effect.", vbInformation, "browseEmbed"
                Cancel = True
                Application.Quit
            End If
        End If
    End If
End Sub

Private Sub bemb_Initialized()

    bemb.SnippetsPath = CurrentProject.Path & gstrBAEMB_DEMO & "\snippets.js"
    Debug.Print Me.Name & " bemb_Initialized"
    Debug.Print , "bemb.SnippetsPath = " & bemb.SnippetsPath

    addWindowResizeHandler
    addChartClickEventHandler

    RefreshChart

End Sub

Private Sub addChartClickEventHandler()
' Method one, build script here in VBA
'   Dim preReturnScript As String
'
'   preReturnScript = ""
'   preReturnScript = preReturnScript & "  var points = window.myLine.getPointsAtEvent(event); "
'   preReturnScript = preReturnScript & "  bembData = points[0].value + ', ' + points[1].value; "
'
'   bemb.AddEventHandler "#canvas", "click", Me, "bembEvent_ChartClick", preReturnScript

' Method two, load script from snippets
    Dim script As String

    script = bemb.GetSnippet("ChartClickHandlerSnippet")

    bemb.AddEventHandler "#canvas", "click", Me, "bembEvent_ChartClick", script

End Sub

Public Sub bembEvent_ChartClick()
    If bemb.LastData <> "" Then
        DoCmd.OpenForm "demoChartJSPopup", , , , , acDialog, "The values of the clicked point were " & bemb.LastData
    End If
End Sub

Private Sub addWindowResizeHandler()
'In this one, the element selector for jQuery is the window object, so we
'can't have that wrapped in quotes, thus we'll set the OmitElementSelectorQuoteWrap to true

' Method one, build script here in VBA
'   Dim s As String
'   s = ""
'   s = s & "Canvas.width = window.innerWidth;"
'   s = s & "Canvas.height = window.innerHeight;"
'
'   bemb.AddEventHandler "window", "resize", Me, "bembEvent_WindowResized", s, True

' Method two, load script from snippets
    Dim script As String

    script = bemb.GetSnippet("WindowResizedHandlerSnippet")

    bemb.AddEventHandler "window", "resize", Me, "bembEvent_WindowResized", script, True

End Sub

Public Sub bembEvent_WindowResized()
  RefreshChart
End Sub

Public Sub RefreshChart()
      ' METHOD ONE: Build script in VBA
      '
      '   Dim script As String
      '   Dim rs As DAO.Recordset
      '
      '   script = "refreshChart({"
      '   script = script & " labels: ['January','February','March','April','May','June','July'],"
      '   script = script & " datasets: [{ label: 'My First dataset', fillColor: 'rgba(220,220,220,0.2)',"
      '   script = script & "strokeColor:'rgba(220,220,220,1)',pointColor:'rgba(220,220,220,1)',pointStrokeColor:'#fff',"
      '   script = script & "pointHighlightFill:'#fff',pointHighlightStroke:'rgba(220,220,220,1)',"
      '   script = script & "data : ["
      '
      '   Set rs = CurrentDb.OpenRecordset("demoChartJSQuery1")
      '
      '   While Not rs.EOF
      '       script = script & rs("TotalPerMonth") & ","
      '       rs.MoveNext
      '   Wend
      '   rs.Close
      '   'trim the last comma
      '   script = Left(script, Len(script) - 1)
      '
      '   script = script & "]},{"
      '   script = script & "label: 'My Second dataset',fillColor:'rgba(151,187,205,0.2)',strokeColor:'rgba(151,187,205,1)',"
      '   script = script & "pointColor:'rgba(151,187,205,1)',pointStrokeColor:'#fff',pointHighlightFill:'#fff',pointHighlightStroke:'rgba(151,187,205,1)',"
      '   script = script & "data: ["
      '
      '   Set rs = CurrentDb.OpenRecordset("demoChartJSQuery2")
      '
      '   While Not rs.EOF
      '       script = script & rs("TotalPerMonth") & ","
      '       rs.MoveNext
      '   Wend
      '   rs.Close
      '
      '   'trim the last comma
      '   script = Left(script, Len(script) - 1)
      '
      '   script = script & "]}]"
      '
      '   script = script & "});"
      '
      '   bemb.ExecScript script

      ' METHOD TWO: Load Script from Snippet
      '   |VALUE| is used to denote parameters, which we'll replace with generated data...

10        On Error GoTo Err_Proc

          Dim script As String
          Dim rs As DAO.Recordset
          Dim s As String

20        script = bemb.GetSnippet("RefreshChartDataBuild")
30        Debug.Print Me.Name & " RefreshChart RefreshChartDataBuild"

          'load dataset1
40        Set rs = CurrentDb.OpenRecordset("demoChartJSQuery1")

50        While Not rs.EOF
60            s = s & rs("TotalPerMonth") & ","
70            rs.MoveNext
80        Wend
90        rs.Close

          'trim the last comma
100       s = Left(s, Len(s) - 1)
110       script = Replace(script, "|DATASET1|", s)
120       Debug.Print , "|DATASET1| = " & script

          'load dataset2
130       s = ""
140       Set rs = CurrentDb.OpenRecordset("demoChartJSQuery2")

150       While Not rs.EOF
160           s = s & rs("TotalPerMonth") & ","
170           rs.MoveNext
180       Wend
190       rs.Close

          'trim the last comma
200       s = Left(s, Len(s) - 1)
210       script = Replace(script, "|DATASET2|", s)
220       Debug.Print , "|DATASET2| = " & script

230       bemb.ExecScript script

Exit_Proc:
240       Exit Sub

Err_Proc:
250       MsgBox "Erl=" & Erl & " Error " & Err.Number & " (" & Err.Description & ") in procedure RefreshChart of Form demoBaembChartJS"
260       Resume Exit_Proc
270       Resume
End Sub

Private Sub btnRefreshChart_Click()
    RefreshChart
End Sub

Private Sub Form_Load()
    Dim intTwips As Integer
    intTwips = 1440
    DoCmd.MoveSize 0, 0, 14 * intTwips, 6 * intTwips

    Set bemb = New BembObject

    bemb.AllowScroll = False

    Dim strChartName As String
    strChartName = "\demoChartJS\charting.html"
    Debug.Print Me.Name & " Form_Load"
    Debug.Print , "strChartName = " & strChartName
    bemb.Init Me.subChart, CurrentProject.Path & gstrBAEMB_DEMO & strChartName
End Sub

Private Sub Form_Unload(Cancel As Integer)
    If Not bemb Is Nothing Then Set bemb = Nothing
End Sub
